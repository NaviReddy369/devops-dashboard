rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Profile Photos
    match /taskerProfiles/{userId}/profilePhoto/{fileName} {
      // Users can upload, update, and delete their own profile photo
      allow write: if request.auth != null 
        && request.auth.uid == userId
        && request.resource.size < 5 * 1024 * 1024 // 5MB max
        && request.resource.contentType.matches('image/.*');
      
      // Users can delete their own profile photos
      allow delete: if request.auth != null && request.auth.uid == userId;
      
      // Anyone can read profile photos
      allow read: if true;
    }
    
    // Project Images
    match /taskerProfiles/{userId}/projects/{projectId}/images/{fileName} {
      // Users can upload, update, and delete project images
      allow write: if request.auth != null 
        && request.auth.uid == userId
        && request.resource.size < 5 * 1024 * 1024 // 5MB max
        && request.resource.contentType.matches('image/.*');
      
      // Users can delete their own project images
      allow delete: if request.auth != null && request.auth.uid == userId;
      
      // Anyone can read project images
      allow read: if true;
    }
    
    // Project Files - CSV Data
    match /taskerProfiles/{userId}/projects/{projectId}/data/{fileName} {
      // Users can upload, update, and delete CSV files
      allow write: if request.auth != null 
        && request.auth.uid == userId
        && request.resource.size < 10 * 1024 * 1024 // 10MB max
        && fileName.matches('.*\\.csv$');
      
      // Users can delete their own CSV files
      allow delete: if request.auth != null && request.auth.uid == userId;
      
      // Anyone can read CSV files
      allow read: if true;
    }
    
    // Project Files - Python Code
    match /taskerProfiles/{userId}/projects/{projectId}/code/{fileName} {
      // Users can upload, update, and delete Python files
      allow write: if request.auth != null 
        && request.auth.uid == userId
        && request.resource.size < 5 * 1024 * 1024 // 5MB max
        && fileName.matches('.*\\.py$');
      
      // Users can delete their own Python files
      allow delete: if request.auth != null && request.auth.uid == userId;
      
      // Anyone can read Python files
      allow read: if true;
    }
    
    // Project Files - PDF Documentation
    match /taskerProfiles/{userId}/projects/{projectId}/docs/{fileName} {
      // Users can upload, update, and delete PDF files
      allow write: if request.auth != null 
        && request.auth.uid == userId
        && request.resource.size < 20 * 1024 * 1024 // 20MB max
        && fileName.matches('.*\\.pdf$');
      
      // Users can delete their own PDF files
      allow delete: if request.auth != null && request.auth.uid == userId;
      
      // Anyone can read PDF files
      allow read: if true;
    }
    
    // Default: deny all other paths
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

